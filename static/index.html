<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SkillGuard â€” Agent Dashboard</title>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg-primary: #0a0e17;
  --bg-card: #1a2236;
  --bg-input: #0f1629;
  --border: #2a3550;
  --text-primary: #e2e8f0;
  --text-secondary: #94a3b8;
  --text-muted: #64748b;
  --accent: #3b82f6;
  --safe: #22c55e;
  --safe-bg: rgba(34,197,94,0.12);
  --caution: #eab308;
  --caution-bg: rgba(234,179,8,0.12);
  --dangerous: #f97316;
  --dangerous-bg: rgba(249,115,22,0.12);
  --malicious: #ef4444;
  --malicious-bg: rgba(239,68,68,0.12);
  --radius: 8px;
  --radius-lg: 12px;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  line-height: 1.6;
  min-height: 100vh;
}

.container { max-width: 960px; margin: 0 auto; padding: 24px 16px; }

header { text-align: center; margin-bottom: 32px; }
header h1 { font-size: 2rem; font-weight: 700; letter-spacing: -0.02em; }
header h1 span { color: var(--accent); }
header p { color: var(--text-secondary); margin-top: 4px; font-size: 0.95rem; }

.card {
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: var(--radius-lg); padding: 20px; margin-bottom: 20px;
}
.card-title {
  font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.08em;
  color: var(--text-muted); margin-bottom: 12px; font-weight: 600;
}

/* Status */
.status-row { display: flex; gap: 16px; flex-wrap: wrap; align-items: center; }
.status-badge {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;
}
.status-badge.online { background: var(--safe-bg); color: var(--safe); }
.status-badge.offline { background: var(--malicious-bg); color: var(--malicious); }
.status-badge .dot { width: 8px; height: 8px; border-radius: 50%; background: currentColor; }
.status-meta { color: var(--text-secondary); font-size: 0.82rem; }
.status-meta span { margin-right: 16px; }
.status-meta code { color: var(--text-primary); font-size: 0.8rem; }

/* x402 info */
.x402-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
}
.x402-item { background: var(--bg-input); border-radius: var(--radius); padding: 12px 14px; }
.x402-label { font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 4px; }
.x402-value { font-size: 0.9rem; color: var(--text-primary); font-family: 'SF Mono', 'Fira Code', monospace; word-break: break-all; }
.x402-value.highlight { color: var(--safe); font-weight: 600; }

/* Stats grid */
.stats-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; }
.stat-card {
  background: var(--bg-input); border-radius: var(--radius); padding: 14px;
  text-align: center;
}
.stat-value { font-size: 1.5rem; font-weight: 700; color: var(--text-primary); }
.stat-label { font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; margin-top: 2px; }

/* Classification breakdown bars */
.breakdown { margin-top: 4px; }
.breakdown-row {
  display: flex; align-items: center; gap: 10px; margin-bottom: 8px;
}
.breakdown-label { width: 80px; font-size: 0.8rem; color: var(--text-secondary); text-align: right; }
.breakdown-track { flex: 1; height: 20px; background: var(--bg-primary); border-radius: 4px; overflow: hidden; position: relative; }
.breakdown-fill { height: 100%; border-radius: 4px; transition: width 0.6s ease; min-width: 0; }
.breakdown-count { width: 50px; font-size: 0.82rem; color: var(--text-primary); font-family: monospace; }

/* Endpoint table */
.endpoint-table { width: 100%; border-collapse: collapse; }
.endpoint-table th, .endpoint-table td {
  text-align: left; padding: 8px 12px; font-size: 0.85rem;
  border-bottom: 1px solid var(--border);
}
.endpoint-table th { color: var(--text-muted); font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.06em; }
.endpoint-table td { color: var(--text-primary); }
.endpoint-table td code { font-size: 0.82rem; color: var(--accent); }
.endpoint-table td.price { color: var(--safe); font-family: monospace; }
.endpoint-table td.free { color: var(--text-muted); }

footer {
  text-align: center; color: var(--text-muted); font-size: 0.78rem;
  margin-top: 32px; padding-top: 16px; border-top: 1px solid var(--border);
}
footer a { color: var(--accent); text-decoration: none; }
footer a:hover { text-decoration: underline; }

@media (max-width: 600px) {
  .x402-grid { grid-template-columns: 1fr; }
  .stats-grid { grid-template-columns: repeat(2, 1fr); }
}
</style>
</head>
<body>
<div class="container">

  <header>
    <h1><span>Skill</span>Guard</h1>
    <p>Agent safety classifier &mdash; pay-per-request via x402 on Base</p>
  </header>

  <!-- Server Status -->
  <div class="card">
    <div class="card-title">Service Status</div>
    <div class="status-row">
      <span class="status-badge offline" id="status-badge"><span class="dot"></span> <span id="status-text">Checking...</span></span>
    </div>
    <div class="status-meta" id="status-meta" style="margin-top:10px"></div>
  </div>

  <!-- x402 Payment Info -->
  <div class="card">
    <div class="card-title">x402 Payment</div>
    <div class="x402-grid">
      <div class="x402-item">
        <div class="x402-label">Price per evaluation</div>
        <div class="x402-value highlight">$0.001 USDC</div>
      </div>
      <div class="x402-item">
        <div class="x402-label">Network</div>
        <div class="x402-value">Base (eip155:8453)</div>
      </div>
      <div class="x402-item">
        <div class="x402-label">Protocol</div>
        <div class="x402-value">HTTP 402 / x402 v2</div>
      </div>
      <div class="x402-item">
        <div class="x402-label">Facilitator</div>
        <div class="x402-value">CDP Mainnet</div>
      </div>
    </div>
  </div>

  <!-- Endpoints -->
  <div class="card">
    <div class="card-title">Endpoints</div>
    <table class="endpoint-table">
      <thead>
        <tr><th>Method</th><th>Path</th><th>Auth</th><th>Price</th></tr>
      </thead>
      <tbody>
        <tr><td>POST</td><td><code>/api/v1/evaluate</code></td><td>API key or x402</td><td class="price">$0.001</td></tr>
        <tr><td>POST</td><td><code>/api/v1/evaluate/name</code></td><td>API key or x402</td><td class="price">$0.001</td></tr>
        <tr><td>GET</td><td><code>/health</code></td><td>None</td><td class="free">Free</td></tr>
        <tr><td>GET</td><td><code>/stats</code></td><td>None</td><td class="free">Free</td></tr>
      </tbody>
    </table>
  </div>

  <!-- Live Stats -->
  <div class="card">
    <div class="card-title">Live Statistics</div>
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-value" id="st-total">-</div><div class="stat-label">Total Requests</div></div>
      <div class="stat-card"><div class="stat-value" id="st-errors">-</div><div class="stat-label">Errors</div></div>
      <div class="stat-card"><div class="stat-value" id="st-ep-eval">-</div><div class="stat-label">Evaluate</div></div>
      <div class="stat-card"><div class="stat-value" id="st-ep-name">-</div><div class="stat-label">By Name</div></div>
    </div>
  </div>

  <!-- Classification Breakdown -->
  <div class="card">
    <div class="card-title">Classifications</div>
    <div class="breakdown" id="cls-breakdown">
      <div class="breakdown-row">
        <div class="breakdown-label">Safe</div>
        <div class="breakdown-track"><div class="breakdown-fill" id="bar-safe" style="width:0%;background:var(--safe)"></div></div>
        <div class="breakdown-count" id="ct-safe">0</div>
      </div>
      <div class="breakdown-row">
        <div class="breakdown-label">Caution</div>
        <div class="breakdown-track"><div class="breakdown-fill" id="bar-caution" style="width:0%;background:var(--caution)"></div></div>
        <div class="breakdown-count" id="ct-caution">0</div>
      </div>
      <div class="breakdown-row">
        <div class="breakdown-label">Dangerous</div>
        <div class="breakdown-track"><div class="breakdown-fill" id="bar-dangerous" style="width:0%;background:var(--dangerous)"></div></div>
        <div class="breakdown-count" id="ct-dangerous">0</div>
      </div>
      <div class="breakdown-row">
        <div class="breakdown-label">Malicious</div>
        <div class="breakdown-track"><div class="breakdown-fill" id="bar-malicious" style="width:0%;background:var(--malicious)"></div></div>
        <div class="breakdown-count" id="ct-malicious">0</div>
      </div>
    </div>
  </div>

  <!-- Decisions -->
  <div class="card">
    <div class="card-title">Decisions</div>
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-value" id="st-allow" style="color:var(--safe)">-</div><div class="stat-label">Allow</div></div>
      <div class="stat-card"><div class="stat-value" id="st-deny" style="color:var(--malicious)">-</div><div class="stat-label">Deny</div></div>
      <div class="stat-card"><div class="stat-value" id="st-flag" style="color:var(--caution)">-</div><div class="stat-label">Flag</div></div>
    </div>
  </div>

  <footer>
    <span id="footer-version">SkillGuard</span> &middot;
    <a href="https://github.com/hshadab/skillguard" target="_blank" rel="noopener">GitHub</a> &middot;
    <a href="https://www.x402.org/" target="_blank" rel="noopener">x402 Protocol</a>
  </footer>

</div>

<script>
function $(id) { return document.getElementById(id); }

function escHtml(str) {
  var d = document.createElement('div');
  d.textContent = str;
  return d.innerHTML;
}

function formatUptime(s) {
  if (s < 60) return s + 's';
  if (s < 3600) return Math.floor(s / 60) + 'm ' + (s % 60) + 's';
  var h = Math.floor(s / 3600);
  var m = Math.floor((s % 3600) / 60);
  if (h < 24) return h + 'h ' + m + 'm';
  var days = Math.floor(h / 24);
  return days + 'd ' + (h % 24) + 'h';
}

function checkHealth() {
  fetch('/health')
    .then(function(r) { return r.json(); })
    .then(function(d) {
      $('status-badge').className = 'status-badge online';
      $('status-text').textContent = 'Online';
      var uptime = formatUptime(d.uptime_seconds);
      var hash = d.model_hash.length > 20 ? d.model_hash.slice(0, 20) + '...' : d.model_hash;
      $('status-meta').innerHTML =
        '<span>Version: <code>' + escHtml(d.version) + '</code></span>' +
        '<span>Model: <code>' + escHtml(hash) + '</code></span>' +
        '<span>Uptime: <code>' + escHtml(uptime) + '</code></span>';
      $('footer-version').textContent = 'SkillGuard v' + d.version;
    })
    .catch(function() {
      $('status-badge').className = 'status-badge offline';
      $('status-text').textContent = 'Offline';
      $('status-meta').innerHTML = '';
    });
}

function loadStats() {
  fetch('/stats')
    .then(function(r) { return r.json(); })
    .then(function(d) {
      $('st-total').textContent = d.requests.total;
      $('st-errors').textContent = d.requests.errors;
      $('st-ep-eval').textContent = d.endpoints.evaluate;
      $('st-ep-name').textContent = d.endpoints.evaluate_by_name;
      $('st-allow').textContent = d.decisions.allow;
      $('st-deny').textContent = d.decisions.deny;
      $('st-flag').textContent = d.decisions.flag;

      var cls = d.classifications;
      var total = cls.safe + cls.caution + cls.dangerous + cls.malicious;
      var max = Math.max(cls.safe, cls.caution, cls.dangerous, cls.malicious, 1);

      $('ct-safe').textContent = cls.safe;
      $('ct-caution').textContent = cls.caution;
      $('ct-dangerous').textContent = cls.dangerous;
      $('ct-malicious').textContent = cls.malicious;

      $('bar-safe').style.width = (cls.safe / max * 100) + '%';
      $('bar-caution').style.width = (cls.caution / max * 100) + '%';
      $('bar-dangerous').style.width = (cls.dangerous / max * 100) + '%';
      $('bar-malicious').style.width = (cls.malicious / max * 100) + '%';
    })
    .catch(function() {});
}

checkHealth();
loadStats();
setInterval(checkHealth, 30000);
setInterval(loadStats, 10000);
</script>
</body>
</html>
